name: Parallel Deployment

on:
  push:
    branches:
      - main

jobs:
  fetch-runners:
    runs-on: ubuntu-latest

    outputs:
      runner_labels: ${{ steps.set-output.outputs.runner_labels }}

    steps:
      - name: Install jq
        run: sudo apt-get update && sudo apt-get install -y jq

      - name: Fetch all self-hosted runners
        id: set-output
        run: |
          TOKEN="${{ secrets.PAT }}"
          REPO="${{ github.repository }}"
          API_URL="https://api.github.com/repos/${REPO}/actions/runners"

          echo "Fetching runners for repository: $REPO"
          echo "GitHub API URL: $API_URL"

          RUNNERS=$(curl -s -X GET -H "Authorization: Bearer ${TOKEN}" "${API_URL}")
          echo "Fetched runners information: $RUNNERS"

          RUNNER_LABELS=$(echo "${RUNNERS}" | jq -r '.runners[] | select(.status == "online") | .labels[] | select(.name | startswith
